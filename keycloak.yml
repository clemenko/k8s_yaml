apiVersion: v1
kind: Namespace
metadata:
  name: keycloak
  labels:
    istio-injection: disabled
---
apiVersion: v1
kind: Service
metadata:
  name: keycloak
  namespace: keycloak
  labels:
    app: keycloak
spec:
  ports:
  - name: http
    port: 8080
    targetPort: 8080
  - name: https
    port: 8443
    targetPort: 8443
  selector:
    app: keycloak
  type: LoadBalancer
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: keycloak
  namespace: keycloak
  labels:
    app: keycloak
spec:
  replicas: 1
  selector:
    matchLabels:
      app: keycloak
  template:
    metadata:
      labels:
        app: keycloak
    spec:
      containers:
      - name: keycloak
        image: quay.io/keycloak/keycloak:legacy
#       args: ["start"]
        env:
        - name: KEYCLOAK_URL
          value: "keycloak.rfed.io"        
        - name: KEYCLOAK_HOST
          value: "keycloak.rfed.io"
        - name: KEYCLOAK_USER
          value: "admin"
        - name: KEYCLOAK_PASSWORD
          value: "Pa22word"
        - name: PROXY_ADDRESS_FORWARDING
          value: "true"
        - name: KEYCLOAK_DISABLE-TRUST-MANAGER
          value: "true"
        - name: KC_PROXY
          value: "edge"
        ports:
        - name: http
          containerPort: 8080
        - name: https
          containerPort: 8443
        readinessProbe:
          httpGet:
            path: /auth/realms/master
            port: 8080

# add PVC
---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRouteTCP
metadata:
  name: keycloak
  namespace: keycloak
spec:
  entryPoints:
    - tcp
  routes:
    - match: HostSNI(`keycloak.rfed.io`)
      services:
        - name: keycloak
          port: 8080
  tls:
#    passthrough: true
      domains:
      - main: keycloak.rfed.io
      secretName: keycloak-tls

---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: keycloak
  namespace: keycloak
spec:
  entryPoints:
    - web
  routes:
    - match: Host(`keycloak.rfed.io`)
      kind: Rule
      services:
        - name: keycloak
          port: 8080
---
apiVersion: v1
kind: Secret
metadata:
  name: keycloak-tls
  namespace: keycloak
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVWRENDQXJ5Z0F3SUJBZ0lSQU5zSWdjU3cwSWFuS2tqN2RwZzFsV293RFFZSktvWklodmNOQVFFTEJRQXcKZ1lreEhqQWNCZ05WQkFvVEZXMXJZMlZ5ZENCa1pYWmxiRzl3YldWdWRDQkRRVEV2TUMwR0ExVUVDd3dtWTJ4bApiV1Z1YTI5QVkyeGxiV0ZwY2k1c2IyTmhiQ0FvUVc1a2VTQkRiR1Z0Wlc1cmJ5a3hOakEwQmdOVkJBTU1MVzFyClkyVnlkQ0JqYkdWdFpXNXJiMEJqYkdWdFlXbHlMbXh2WTJGc0lDaEJibVI1SUVOc1pXMWxibXR2S1RBZUZ3MHkKTWpBMk1EZ3dNek13TWpsYUZ3MHlOREE1TURnd016TXdNamxhTUZveEp6QWxCZ05WQkFvVEhtMXJZMlZ5ZENCawpaWFpsYkc5d2JXVnVkQ0JqWlhKMGFXWnBZMkYwWlRFdk1DMEdBMVVFQ3d3bVkyeGxiV1Z1YTI5QVkyeGxiV0ZwCmNpNXNiMk5oYkNBb1FXNWtlU0JEYkdWdFpXNXJieWt3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXcKZ2dFS0FvSUJBUUM5ZUh6V3NrQnRlWDJ1dFNhRVpsRStKYTJQSWY0cmZFSGw3dnZLVTRHNHk0bUdmNzRWWTRzOQprZFhSSlhLazVOandySzdnbVlIdTZpZWE4VHJZYUMxR1ZyRzVwTXF3d2RFYWNWOGJWOG9XaXNxYndMdjBtNEw5Cnpvc3FOUGdkVStOZjVYZGdXNFRXZHp4WUZ5TFk2U1ErSzV5aW1DT0psTUNYby9TbUx1a3FKRFZmajViVjV3elMKajNSU3BsdHBmL2piZ2FXNmZpb09Hd3YrampQOFZKZHB0MGJ5YXJ4ZXE4aXh0YS9FYWRKazQyblEwZFlxRmw1Vgp2TXRjcmo5WEhQVkpWUm1NZGZSZXRTSG9hUXFKK0ttbi9KcU1IQVJLYTBlUmpWd3NLRVVEL2ltdHp6UC83ZElrCjVGRUI1dWs2ZlVhV3B2bldzRVZhOFNHRStSV0Q0TzhqQWdNQkFBR2paVEJqTUE0R0ExVWREd0VCL3dRRUF3SUYKb0RBVEJnTlZIU1VFRERBS0JnZ3JCZ0VGQlFjREFUQWZCZ05WSFNNRUdEQVdnQlNSV3Z1bWlYUWNySmFHS0tTNgpzYmp4RmEwcEh6QWJCZ05WSFJFRUZEQVNnaEJyWlhsamJHOWhheTV5Wm1Wa0xtbHZNQTBHQ1NxR1NJYjNEUUVCCkN3VUFBNElCZ1FCMWhRc2E2N0FBSGwwVk1sN0I5MENxZVZZa1QzM2V3T3V3dzg5VXl5NHlYekljekhNWTBjSEsKRFhva3RoZWtPV3VWeEx1U2VUcm1lMzRYZ3UybDR3cndQOW9nbGJCV051TUhkdjV1ZzBxRlNSZk5uYU1FbUFoeQp2d3BsUGpYZzZZTHhLdW82V1drUisweVAycGdjbFk5eEw4OHE5ODNsbGducjRUTWRKVmZpalhRdnpBSFJSZmVzCklpTlpQOXVHbkhRbFlhY21JbzZyWUFGb3U4RkxVeXJqYXFtVU0yV1BnQ3pXSjY1cUFncjF0UHoxaVZjWGlRWlYKc0EvdXdhSlV6OVZiMEdOc1BiQSsxSFdkV2ZQTU5FcmpnUzl0MGdmUGtobDE1ZnN4MHNhUlIvb3F1VDJxRkFiZApyQ0FjSVFFUUpzT2FXVWRSWTZTRVI5ekZ2WGRUSytMWnk3VytsekNQaFUyRnlXUnU5RXhlVnprblNCbjdOc1VzCmVlQlk2L1RuNzBBSlpMbytmY3hpQTBZKzF5R1Y1ZTY1Vzk5UGFTTVdVUUFWSUVDb00vdDZzc1FrYUVyNnp1MWwKVE5OeGQ0OWZJV3dZZjczdGNPV21MNzNkbW9JOHNGS1oveC83M1FkQWxTU3lUNXpLbm40QXE2SUEwVGFJWDdEaQpkSVJYRFYrRVFUMD0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQzllSHpXc2tCdGVYMnUKdFNhRVpsRStKYTJQSWY0cmZFSGw3dnZLVTRHNHk0bUdmNzRWWTRzOWtkWFJKWEtrNU5qd3JLN2dtWUh1NmllYQo4VHJZYUMxR1ZyRzVwTXF3d2RFYWNWOGJWOG9XaXNxYndMdjBtNEw5em9zcU5QZ2RVK05mNVhkZ1c0VFdkenhZCkZ5TFk2U1ErSzV5aW1DT0psTUNYby9TbUx1a3FKRFZmajViVjV3elNqM1JTcGx0cGYvamJnYVc2ZmlvT0d3disKampQOFZKZHB0MGJ5YXJ4ZXE4aXh0YS9FYWRKazQyblEwZFlxRmw1VnZNdGNyajlYSFBWSlZSbU1kZlJldFNIbwphUXFKK0ttbi9KcU1IQVJLYTBlUmpWd3NLRVVEL2ltdHp6UC83ZElrNUZFQjV1azZmVWFXcHZuV3NFVmE4U0dFCitSV0Q0TzhqQWdNQkFBRUNnZ0VBT1diYWMzVVhmZE16MTQwOE9ScUNmSkNQcjNCOS81Q3FxazJuN05rMTBOV2gKT2FWVDRra0JNMHNPZTBtY0hRYlVEcjVTVU90UTZSLzVsY0NGc25DRlh1eis5UjVPNWhRaUZKL0tUNDllUTB3VApLL0xOUHNNcWdWaGs0d21mTGN0dmRHc2hxb2l2aXdZZXV4VnZVa1gzMi9uOGYyb1dRaVZWMzlzbFVIK2Yxa3NTCmJiR212NWJLNXNvSlNQYUtBTjhUN1QyYlpWZUI1L1JuVFoyMTRlOTlOU1pUeXo3MEl3dnNyYk5MN1k4VmFpSGoKWkMvazc0aHF6eUxuZSsxN2VNdjNJWkRVZEJieG5yYmp0VWZ4MmVxOFRBMUlGbDNpYWpsbEY3RDJ4V0hDeVlpNgpoaVBBWHpPVXlrSktoWi9TMFp0RkJkQm1leVB4TXFIMDR1Tmw4YTRqaVFLQmdRRGxYbGdML3kwajVLZ2t5UUw3CjdRTkdiazlVeFpzWHlDRVdJRG53TGRhbnkyT01uRElOc25kQ0tuMXNEVTFIQWovbG9uaGg3ZmlKU2J2RmRmV3UKdDV0bFhmakJacUtnUkZmZmNWMCtSQWRyTGVIbGF5b2FBSThYeVhaUVRNYUNrMFR1enFUbmNQZlEvM3dqVDFCcwpmMUMwL0R6SGlpM1JEZ1lLU3AwUE5Hd3pOUUtCZ1FEVGVEeFI4eHhWRmM5R3V6M2M4b25xVjJtZS9STmFzS2N1ClZDbVlDMVRiQlBQR2ZPc0J6MUEyR29DV3ZQMmpuMHh6NitFL0h2K2VUcE9qd2gzbkMyRlVWTzdhU0Z5c2NNdXMKaGtwb0x0Um1DWEpSSWFRL2FPeEdEQ3EzUXRraldBbnQ4M0Z3VEwyYng1Zk1CSWpKNUtBZitNMXlXTURBVUNCMgppZDZ3ZHU5TDl3S0JnQW45RDh5RjhrdEwyOTZ1T2trS1MwZzM2WkNCZ24ySW81ZzVFd3pZa2k2QWR2ZGFuZnRtCnVEYlRidDdUdlhmSUswd3V4UnRPcDdJaTJlQ0JnSTk1UTNVb29IcWJvNTFqSElpSWdVMEMzV2ZYZWF6cCs4MWkKRk5rdVZzNnNhVUNxZFNnSks3bEFmQ3BIMWZvYnJCN3RkSEJOUThCVXppWDZmRnphWHZpWWlkVzVBb0dCQUx0ZAp0ZnhhTGdsSldLenY3QUVmT0lsVXgvV2hnQXVEcDYwSnp3eXpSWTBGVjBUUG01MnY1UDc2L21JUXM1N00zdjE2CnlzbVZtcURXT0VRSkUxdUtIc09NdVZEWWVwd2pHS01WSFVvdjYrczRoWHhURldkRmZNc1hycVZQYW5yQlg1TGcKZHVzc1kzZHFJaG9YRG1mcjFPQmZIeEVvaUNnZEZwWlEwK21BaDhmREFvR0FaTkF5ZGlaU1NZS3dxNTBFaS9RMwo0NkczZ3NxZEViY3NpR1RDbkx6bkY2bFFPLy9ZRjE5eElvNjJUcnZOQ3haeWRpVFp2Qm42eEVzNlduQmJWOHVRCmJUbDhxSmdUcG8zTUlzSGpVYkg0UXAxK2ErL0tXaVIybGUxZ2I5clZSazBmOGl5Q1hra3ZpQ3p6Znp5WjF4aUYKZkZHaXhFNTMybTBJQWxQdzBhUXVoVGM9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
